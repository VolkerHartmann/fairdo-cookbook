<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js navy">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Search for PIDs - FAIR DO Cookbook</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        
        <link rel="stylesheet" href="../hierarchical_numbered_lists.css">
        
        <link rel="stylesheet" href="../chapter_list.css">
        
        <link rel="stylesheet" href="../theme-adjustments.css">
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "navy";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('navy')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="../about.html">About</a></li><li class="chapter-item affix "><a href="../pids/intro.html">Introduction to PIDs and FAIR DOs</a></li><li class="spacer"></li><li class="chapter-item "><a href="../pids/create.html">Create a PID</a></li><li class="chapter-item "><a href="../pids/resolve.html">Resolve a PID</a></li><li class="chapter-item "><a href="../pids/update.html">Update/maintain a PID</a></li><li class="chapter-item "><a href="../pids/delete.html">Delete a PID</a></li><li class="chapter-item "><a href="../pids/notify.html">Inform (or be informed) about new or changed PIDs</a></li><li class="chapter-item expanded "><a href="../pids/search.html" class="active">Search for PIDs</a></li><li class="chapter-item "><a href="../pids/validate.html">Validate a PID record</a></li><li class="chapter-item "><a href="../datatypes_intro.html">Create a Data Type</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../datatypes_step_1.html">Search data type registry for suitable data type</a></li><li class="chapter-item "><a href="../datatypes_step_2.html">Describe/model envisioned data type</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../datatypes_step_2_1.html">Decide on Data Type‘s level of detail</a></li><li class="chapter-item "><a href="../datatypes_step_2_2.html">DTR Inquiry</a></li></ol></li><li class="chapter-item "><a href="../datatypes_step_3.html">Register data type(s) in data type registry</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../datatypes_step_3_1.html">Register new Child-Data Type(s)</a></li><li class="chapter-item "><a href="../datatypes_step_3_2.html">Register extended Child-Data Type(s)</a></li><li class="chapter-item "><a href="../datatypes_step_3_3.html">Register main Data Type</a></li></ol></li></ol></li><li class="chapter-item "><a href="../kip_intro.html">Create a PID KIP</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../kip_step_1.html">Search data type registry for suitable KIP</a></li><li class="chapter-item "><a href="../kip_step_2.html">Describe/model envisioned KIP</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../kip_step_2_1.html">Call to mind basic KIP principles</a></li><li class="chapter-item "><a href="../kip_step_2_2.html">Decide on KIP contents</a></li></ol></li><li class="chapter-item "><a href="../kip_step_3.html">Register new KIP in Data Type Registry</a></li></ol></li><li class="chapter-item "><a href="../appendix/intro.html">Appendix</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../appendix/appendix_pit.html">Typed PID Maker</a></li><li class="chapter-item "><a href="../appendix/appendix_testbed.html">FAIR DO Ecosystem Testbed</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder" class="click-transparent"></div>
                <div class="logo-header mobile-on">
    <div class="logo-spacing-general">
        <a class="logo-align-middle logo-card"
        href="https://kit.edu/"
        title="Karlsruhe Institute of Technology"
        aria-label="Visit the KIT Website">
            <img class="lightonly" src="../kit_logo_en_black.svg" alt="KIT logo">
            <img class="darkonly" src="../kit_logo_en_white.svg" alt="KIT logo">
            <img class="whiteonly" src="../kit_logo_en.svg" alt="KIT logo">
        </a>
    </div>
</div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title" title="FAIR DO Cookbook">
                        FAIR DO Cookbook
                    </h1>

                    <div class="right-buttons">
                        <div class="logo-spacing-general">
                            <a class="mobile-off logo-align-middle logo-card" href="https://kit.edu/" title="Karlsruhe Institute of Technology" aria-label="Visit the KIT Website">
                                <img class="lightonly" src="../kit_logo_en_black.svg" alt="KIT logo">
                                <img class="darkonly" src="../kit_logo_en_white.svg" alt="KIT logo">
                                <img class="whiteonly" src="../kit_logo_en.svg" alt="KIT logo">
                            </a>
                        </div>
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/kit-data-manager/fairdo-cookbook/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#search-pids-using-record-information" id="search-pids-using-record-information">Search PIDs using record information</a></h1>
<p>It is a common use case to search for PIDs using the record information or have an automatically created list of all registered PIDs. This recipe will introduce how to enable these use cases using a search index. This approach generally works using the <a href="./notify.html">messaging approach to notify other services</a>. In this case an indexer service will receive the notifications and keep the search index up-to-date. Depending on how much information is ingested into the search index, it may also enable complex analysis of FAIR Digital Objects.</p>
<p><img src="../images/testbed_search.png" alt="A message broker will notify an indexer to update the search index." /></p>
<p>This approach is implemented in the <a href="../appendix/appendix_testbed.html">FAIR Digital Object Ecosystem Testbed</a>. Currently, the indexing functionality has to be set up before the PIDs are registered or changed to make sure they are indexed. To also retrieve older PIDs which are not changing, ecosystems must offer further approaches, like regular &quot;record.refresh&quot; messages, indicating non-changing PIDs regularly or other interfaces to order older PIDs.</p>
<hr />
<h2><a class="header" href="#ingredients" id="ingredients">Ingredients</a></h2>
<p>Either</p>
<ul>
<li>A <a href="../appendix/appendix_testbed.html">FAIR Digital Object Ecosystem Testbed</a> instance, which comes with pre-configured with the ingredients below and will save you step 1 (configuration)</li>
</ul>
<p>or</p>
<ul>
<li>One or more message brokers</li>
<li>A search index (like Elasticsearch, for example)</li>
<li>An indexer service with AMQP support, which ingests PIDs and record information into the search index</li>
</ul>
<hr />
<h2><a class="header" href="#work-steps-summary" id="work-steps-summary">Work Steps (Summary)</a></h2>
<p>As soon as the Typed PID Maker is configured to use the message broker, everything happens in the background. These steps show you how to visualize what happens hidden in the background, when using the testbed.</p>
<ol>
<li>Configuration (not required if testbed is used)</li>
<li>Create some PIDs with record information</li>
<li>Use the search index to search for PIDs</li>
</ol>
<hr />
<h2><a class="header" href="#step-1-configuration-not-required-if-testbed-is-used" id="step-1-configuration-not-required-if-testbed-is-used">Step 1: Configuration (not required if testbed is used)</a></h2>
<p>The testbed is pre-configured to fulfill this use case in the following ways:</p>
<ol>
<li>The Typed PID Maker is configured to send messages to a message broker if PIDs are created. In its <code>application.properties</code> configuration file, we need to configure the message broker and exchange:
<pre><code class="language-yaml">repo.messaging.enabled: true
// hostname and port of your message broker instance
repo.messaging.hostname: messagebroker
repo.messaging.port: 5672
// the exchange the messages are sent to
repo.messaging.sender.exchange: record_events
</code></pre>
</li>
<li>The Indexer will register itself for PID-related messages on start.  In its <code>application.properties</code>configuration file, we use the same settings as above to connect it to the same broker and exchange. Additionally, we configure it to a queue, which usually should be a unique name for this service. The <code>routingKeys</code> parameter defines which message topics are handled by the indexer. The Typed PID Maker sends messages with topics like <code>pidrecord.create</code> and <code>pidrecord.update</code>. The value <code>pidrecord.#</code> means to handle every message with a topic that has <code>pidrecord.</code> as a prefix.
<pre><code class="language-yaml">repo.messaging.enabled: true
repo.messaging.hostname: messagebroker
repo.messaging.port: 5672
repo.messaging.receiver.exchange: record_events
repo.messaging.receiver.queue: indexerQueue  // name of the queue
repo.messaging.receiver.routingKeys: pidrecord.#  // message topics which are handled
</code></pre>
</li>
</ol>
<p>In case you do not use the testbed and instead do your own setup, make sure it is configured this way.</p>
<h2><a class="header" href="#step-2-create-some-pids-with-record-information" id="step-2-create-some-pids-with-record-information">Step 2: Create some PIDs with record information</a></h2>
<p>Use the <a href="./create.html">recipe to create PIDs</a> to create a few dummy PIDs. We recommend configuring the Typed PID Maker with <code>pit.pidsystem.implementation = IN_MEMORY</code> in its <code>application.properties</code> configuration file.</p>
<h2><a class="header" href="#step3-use-the-search-index-to-search-for-pids" id="step3-use-the-search-index-to-search-for-pids">Step3: Use the search index to search for PIDs</a></h2>
<p>As the Typed PID Maker and the Indexer have been configured accordingly in step 1 (or the default configuration of the testbed has been used), the PIDs should have been indexed shortly after their creation. We can now use the index to query information from it. How to do this will depend on your search index engine. We will demonstrate this on the testbed, which uses Elasticsearch as index as well as Kibana for administration and exploration.</p>
<ol>
<li>
<p>Visit <a href="http://127.0.0.1:5601/app/kibana#/discover">http://127.0.0.1:5601/app/kibana#/discover</a></p>
</li>
<li>
<p>Use &quot;record*&quot; as index pattern and click &quot;Next step&quot;</p>
</li>
<li>
<p>In the next screen, you may choose a property to use as time filter or &quot;I don't want to use the Time Filter&quot;. Then click on &quot;Create index pattern&quot;</p>
</li>
<li>
<p>You will now see an overview over the index pattern, stating which properties do exist and which internal type they have.
<img src="../images/testbed_index_pattern_example.png" alt="Example Index Pattern" /></p>
</li>
<li>
<p>Visit <a href="http://127.0.0.1:5601/app/kibana#/discover">http://127.0.0.1:5601/app/kibana#/discover</a> again</p>
</li>
<li>
<p>You can now use the Kibana Query Language and Filters to query your PIDs and select which fields to display. Note that this is just an exploration functionality, and Elasticsearch is a widespread engine offering APIs for all kinds of custom search use cases.</p>
<p><img src="../images/testbed_kibana_example_query.png" alt="Example query, filtering for the DigitalObjectLocation pointing to jpg images." /></p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../pids/notify.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../pids/validate.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../pids/notify.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../pids/validate.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        <script>
            function updateThemeElements() {
                try {
                    var html = document.querySelector('html');
                    var theme = localStorage.getItem('mdbook-theme');
                    var white_themes = ["light"]
                    var light_themes = ["rust"]
                    var light_only_elements = html.getElementsByClassName("lightonly")
                    var dark_only_elements = html.getElementsByClassName("darkonly")
                    var white_only_elements = html.getElementsByClassName("whiteonly")
                    console.log(theme)
                    console.log(light_themes)
                    if (light_themes.includes(theme)) {
                        for (light_only of light_only_elements) {
                            light_only.classList.remove("hideme")
                        }
                        for (dark_only of dark_only_elements) {
                            dark_only.classList.add("hideme")
                        }
                        for (white_only of white_only_elements) {
                            white_only.classList.add("hideme")
                        }
                    } else if (white_themes.includes(theme)) {
                        for (light_only of light_only_elements) {
                            light_only.classList.add("hideme")
                        }
                        for (dark_only of dark_only_elements) {
                            dark_only.classList.add("hideme")
                        }
                        for (white_only of white_only_elements) {
                            white_only.classList.remove("hideme")
                        }
                    } else {
                        for (light_only of light_only_elements) {
                            light_only.classList.add("hideme")
                        }
                        for (dark_only of dark_only_elements) {
                            dark_only.classList.remove("hideme")
                        }
                        for (white_only of white_only_elements) {
                            white_only.classList.add("hideme")
                        }
                    }
                } catch (e) { }
            }
            updateThemeElements() // call it once in the beginning
            // configure to call the function when theme changes.
            // the theme is stored as a class in the html tag, so we observe changes in this tag.
            var themeStorage = document.querySelector('html');
            const config = { attributes: true, childList: false, subtree: false };
            const callback = function(mutationsList, observer) {updateThemeElements()}
            const observer = new MutationObserver(callback);
            observer.observe(themeStorage, config);
        </script>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
